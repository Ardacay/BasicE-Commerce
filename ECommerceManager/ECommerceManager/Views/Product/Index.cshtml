@model IEnumerable<ECommerceManager.Dtos.Product.ProductDto>

@{
	ViewData["Title"] = "Product List";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />

<div class="container mt-5">
	<div class="d-flex justify-content-between align-items-center mb-4">
		<h2 class="text-primary"><i class="fas fa-boxes"></i> Products</h2>
		<a asp-action="Create" class="btn btn-success">
			<i class="fas fa-plus"></i> Add New Product
		</a>
	</div>

	<table class="table table-hover table-bordered table-striped">
		<thead class="table-dark">
			<tr>
				<th>@Html.DisplayNameFor(model => model.First().Id)</th>
				<th>@Html.DisplayNameFor(model => model.First().Name)</th>
				<th>@Html.DisplayNameFor(model => model.First().Price)</th>
				<th>@Html.DisplayNameFor(model => model.First().Stock)</th>
				<th>@Html.DisplayNameFor(model => model.First().CategoryId)</th>
				<th>Category Name</th>
				<th class="text-center">Actions</th>
			</tr>
		</thead>
		<tbody>
			@foreach (var item in Model)
			{
				<tr>
					<td>@item.Id</td>
					<td>@item.Name</td>
					<td>@item.Price ₺</td>
					<td>@item.Stock</td>
					<td>@item.CategoryId</td>
					<td class="category-cell" data-id="@item.CategoryId">
						<span class="category-name text-secondary">
							<i class="fas fa-spinner fa-spin"></i> Loading...
						</span>
					</td>
					<td class="text-center">
						<a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-sm btn-warning me-1">
							<i class="fas fa-edit"></i> Edit
						</a>
						<a asp-action="Details" asp-route-id="@item.Id" class="btn btn-sm btn-info me-1 text-white">
							<i class="fas fa-info-circle"></i> Details
						</a>
						<a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-sm btn-danger">
							<i class="fas fa-trash"></i> Delete
						</a>
					</td>
				</tr>
			}
		</tbody>
	</table>
</div>

@section Scripts {
	<script src="https://code.jquery.com/jquery-3.7.1.min.js" crossorigin="anonymous"></script>
	<script>
		$(document).ready(function () {
			$(".category-cell").each(function () {
				var td = $(this);
				var categoryId = td.data("id");

				$.ajax({
					url: `https://localhost:44321/api/Category/GetById/${categoryId}`,
					method: "GET",
					success: function (data) {
						td.find(".category-name").removeClass("text-secondary").text(data.name);
					},
					error: function () {
						td.find(".category-name").removeClass("text-secondary").text("Bilinmiyor");
					}
				});
			});
		});
	</script>
}
